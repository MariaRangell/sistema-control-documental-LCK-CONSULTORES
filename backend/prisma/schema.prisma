generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model usuarios {
  id                        Int          @id @default(autoincrement())
  nombre_usuario            String       @unique @db.VarChar(50)
  correo                    String       @unique @db.VarChar(100)
  nombre_completo           String       @db.VarChar(100)
  contrasena                String       @map("contraseña") @db.VarChar(255)
  rol                       UserRole     @default(user)
  empresa_asignada          CompanyType?
  activo                    Boolean      @default(true)
  ultimo_login              DateTime?
  fecha_creacion            DateTime     @default(now())
  fecha_actualizacion       DateTime     @default(now()) @updatedAt
  intentos_fallidos         Int          @default(0)
  bloqueado_hasta           DateTime?
  fecha_ultimo_intento      DateTime?
  email_verificado          Boolean      @default(false)
  token_verificacion        String?      @db.VarChar(255)
  token_expira              DateTime?
  esta_online               Boolean?     @default(false)
  ultima_actividad          DateTime?
  ip_ultima_conexion        String?      @db.VarChar(45)
  navegador_ultima_conexion String?
  ubicacion_ultima_conexion String?      @db.VarChar(255)

  // Relación opcional a Empresa (nueva tabla)
  empresaId                 Int?
  empresa                   Empresa?     @relation(fields: [empresaId], references: [id])

  Documento                 Documento[]

  @@map("usuarios")
}

model Categoria {
  id          Int      @id @default(autoincrement())
  nombre      String   @unique
  descripcion String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
}

model Documento {
  id          Int      @id @default(autoincrement())
  titulo      String
  descripcion String?
  archivo     String
  tipo        String
  estado      String   @default("pendiente")
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  usuarioId   Int
  usuarios    usuarios @relation(fields: [usuarioId], references: [id])
}

enum CompanyType {
  empresa
  cliente
  proveedor
}

enum UserRole {
  admin
  empresa
  proveedor
  rh
  cliente
  auditoria
  user
}

model Empresa {
  id              Int      @id @default(autoincrement())
  nombre          String
  rfc             String   @unique
  domicilioFiscal String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  usuarios        usuarios[]

  @@map("empresa")
}
